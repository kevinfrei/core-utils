{"version":3,"sources":["../src/FTON.js"],"names":["typecheck","x","undefined","Array","isArray","map","Map","Set","o","k","Error","replacer","key","value","originalObject","dataType","dataValue","reviver","hasOwnProperty","val","parse","input","JSON","stringify","module","exports"],"mappings":"AACA;AAIA,MAAMA,SAAS,GAAIC,CAAD,IAAwB;AACxC,MACEA,CAAC,KAAK,IAAN,IACA,OAAOA,CAAP,KAAa,QADb,IAEA,OAAOA,CAAP,KAAa,QAFb,IAGA,OAAOA,CAAP,KAAa,SAJf,EAKE;AACA,WAAOA,CAAP;AACD;;AAED,MAAIA,CAAC,KAAKC,SAAV,EAAqB;AACnB,WAAO,IAAP;AACD;;AAED,MAAIC,KAAK,CAACC,OAAN,CAAcH,CAAd,CAAJ,EAAsB;AACpB,WAAOA,CAAC,CAACI,GAAF,CAAML,SAAN,CAAP;AACD;;AAED,MAAI,OAAOC,CAAP,KAAa,QAAjB,EAA2B;AACzB,QAAIA,CAAC,YAAYK,GAAb,IAAoBL,CAAC,YAAYM,GAArC,EAA0C;AACxC,aAAON,CAAP;AACD;;AACD,QAAIO,CAAa,GAAG,EAApB;;AACA,SAAK,IAAIC,CAAT,IAAcR,CAAd,EAAiB;AACfO,MAAAA,CAAC,CAACC,CAAD,CAAD,GAAOT,SAAS,CAACC,CAAC,CAACQ,CAAD,CAAF,CAAhB;AACD;;AACD,WAAOD,CAAP;AACD;;AAED,QAAM,IAAIE,KAAJ,CAAU,cAAV,CAAN;AACD,CA9BD;;AAgCA,SAASC,QAAT,CAAkBC,GAAlB,EAA8BC,KAA9B,EAAmD;AACjD,QAAMC,cAAoB,GAAG,KAAKF,GAAL,CAA7B;;AACA,MAAIE,cAAc,YAAYR,GAA9B,EAAmC;AACjC,WAAO;AACLS,MAAAA,QAAQ,EAAE,KADL;AAELC,MAAAA,SAAS,EAAE,CAAC,GAAGF,cAAJ;AAFN,KAAP;AAID,GALD,MAKO,IAAIA,cAAc,YAAYP,GAA9B,EAAmC;AACxC,WAAO;AACLQ,MAAAA,QAAQ,EAAE,KADL;AAELC,MAAAA,SAAS,EAAE,CAAC,GAAGF,cAAJ;AAFN,KAAP;AAID,GALM,MAKA;AACL,WAAOD,KAAP;AACD;AACF;;AAED,SAASI,OAAT,CAAiBL,GAAjB,EAA6BC,KAA7B,EAAkD;AAChD,MACE,OAAOA,KAAP,KAAiB,QAAjB,IACAA,KAAK,KAAK,IADV,IAEAA,KAAK,CAACK,cAAN,CAAqB,UAArB,CAFA,IAGAL,KAAK,CAACK,cAAN,CAAqB,WAArB,CAJF,EAKE;AACA,UAAMC,GAAU,GAAGN,KAAK,CAACG,SAAzB;;AACA,QAAIb,KAAK,CAACC,OAAN,CAAce,GAAd,CAAJ,EAAwB;AACtB,UAAIN,KAAK,CAACE,QAAN,KAAmB,KAAvB,EAA8B;AAC5B,eAAO,IAAIT,GAAJ,CAAQa,GAAR,CAAP;AACD,OAFD,MAEO,IAAIN,KAAK,CAACE,QAAN,KAAmB,KAAvB,EAA8B;AACnC,eAAO,IAAIR,GAAJ,CAAQY,GAAR,CAAP;AACD;AACF;AACF;;AACD,SAAON,KAAP;AACD;;AACD,MAAMO,KAAK,GAAIC,KAAD,IAA6B;AACzC,SAAOrB,SAAS,CAACsB,IAAI,CAACF,KAAL,CAAWC,KAAX,EAAkBJ,OAAlB,CAAD,CAAhB;AACD,CAFD;;AAIA,MAAMM,SAAS,GAAIF,KAAD,IAA6B;AAC7C,SAAOC,IAAI,CAACC,SAAL,CAAeF,KAAf,EAAsBV,QAAtB,CAAP;AACD,CAFD;;AAIAa,MAAM,CAACC,OAAP,GAAiB;AACfL,EAAAA,KADe;AAEfG,EAAAA,SAFe;AAGfvB,EAAAA;AAHe,CAAjB","sourcesContent":["//@flow\r\n//@format\r\n\r\nimport type { FTONData, FTONObject, FTONArray } from './index';\r\n\r\nconst typecheck = (x: mixed): FTONData => {\r\n  if (\r\n    x === null ||\r\n    typeof x === 'string' ||\r\n    typeof x === 'number' ||\r\n    typeof x === 'boolean'\r\n  ) {\r\n    return x;\r\n  }\r\n\r\n  if (x === undefined) {\r\n    return null;\r\n  }\r\n\r\n  if (Array.isArray(x)) {\r\n    return x.map(typecheck);\r\n  }\r\n\r\n  if (typeof x === 'object') {\r\n    if (x instanceof Map || x instanceof Set) {\r\n      return x;\r\n    }\r\n    let o: FTONObject = {};\r\n    for (let k in x) {\r\n      o[k] = typecheck(x[k]);\r\n    }\r\n    return o;\r\n  }\r\n\r\n  throw new Error('Invalid FTON');\r\n};\r\n\r\nfunction replacer(key: mixed, value: mixed): mixed {\r\n  const originalObject:mixed = this[key];\r\n  if (originalObject instanceof Map) {\r\n    return {\r\n      dataType: 'Map',\r\n      dataValue: [...originalObject]\r\n    };\r\n  } else if (originalObject instanceof Set) {\r\n    return {\r\n      dataType: 'Set',\r\n      dataValue: [...originalObject]\r\n    };\r\n  } else {\r\n    return value;\r\n  }\r\n}\r\n\r\nfunction reviver(key: mixed, value: mixed): mixed {\r\n  if (\r\n    typeof value === 'object' &&\r\n    value !== null &&\r\n    value.hasOwnProperty('dataType') &&\r\n    value.hasOwnProperty('dataValue')\r\n  ) {\r\n    const val: mixed = value.dataValue;\r\n    if (Array.isArray(val)) {\r\n      if (value.dataType === 'Map') {\r\n        return new Map(val);\r\n      } else if (value.dataType === 'Set') {\r\n        return new Set(val);\r\n      }\r\n    }\r\n  }\r\n  return value;\r\n}\r\nconst parse = (input: string): FTONData => {\r\n  return typecheck(JSON.parse(input, reviver));\r\n};\r\n\r\nconst stringify = (input: FTONData): string => {\r\n  return JSON.stringify(input, replacer);\r\n};\r\n\r\nmodule.exports = {\r\n  parse,\r\n  stringify,\r\n  typecheck\r\n};\r\n"],"file":"FTON.js"}